generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================================================================
// ENUMS
// =================================================================

enum Unit {
  UN
  M2
  KG
}

enum StockMovementType {
  SELL
  ADJUST_IN
  ADJUST_OUT
  PRODUCTION
}

enum SupplierType {
  PJ
  PF
}

enum OrderStatus {
  DRAFT
  PENDING
  CONFIRMED
  COMPLETED
  SHIPMENT
  CANCELLED
}

// =================================================================
// MODELS
// =================================================================

model User {
  id            String    @id @default(cuid())
  fullName      String
  email         String    @unique
  document      String?   @unique
  phone         String?
  password      String?
  role          Int?      @default(2)
  status        Int?      @default(3)
  activationKey String?   @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  avatarURL     String?
  products      Product[]
}

model Product {
  id          String   @id @default(cuid())
  name        String
  unit        Unit
  description String?
  status      Int
  price       Decimal  @db.Decimal(14, 2)
  stockOnHand Decimal  @default(0) @db.Decimal(14, 4)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user             User?             @relation(fields: [userId], references: [id])
  userId           String?
  productionOrders ProductionOrder[]
}

model Client {
  id       String       @id @default(cuid())
  type     SupplierType @default(PF)
  name     String
  document String       @unique
  email    String?      @unique
  phone    String?
  status   Int          @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  address Address?
}

model Address {
  id           String  @id @default(cuid())
  street       String
  number       String
  complement   String?
  neighborhood String
  city         String
  state        String
  zipCode      String

  clientId String? @unique
  client   Client? @relation(fields: [clientId], references: [id])
}

enum ProductionStatus {
  PENDING // Ordem Realizada
  IN_PRODUCTION // Em Fabricação
  CONFERENCE // Conferência
  COMPLETED // Pronto (Gera Estoque)
  CANCELLED // Cancelada (Não gera estoque, encerra o fluxo)
}

model ProductionOrder {
  id   String @id @default(uuid())
  code Int    @default(autoincrement())

  productId String
  product   Product @relation(fields: [productId], references: [id])

  quantity Int
  deadline DateTime

  status ProductionStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

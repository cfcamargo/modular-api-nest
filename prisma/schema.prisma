generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================================================================
// ENUMS
// =================================================================

enum Unit {
  UN
  M2
  KG
}

enum StockMovementType {
  SELL
  ADJUST_IN
  ADJUST_OUT
  PRODUCTION
}

enum SupplierType {
  PJ
  PF
}

enum OrderStatus {
  DRAFT
  PENDING
  CONFIRMED
  COMPLETED
  SHIPMENT
  CANCELLED
}

// =================================================================
// MODELS
// =================================================================

model User {
  id            String    @id @default(cuid())
  fullName      String
  email         String    @unique
  document      String?   @unique
  phone         String?
  password      String?
  role          Int?      @default(2)
  status        Int?      @default(3)
  activationKey String?   @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  avatarURL     String?
  products      Product[]
}

model Product {
  id          String   @id @default(cuid())
  name        String
  unit        Unit
  description String?
  status      Int
  price       Decimal  @db.Decimal(14, 2)
  stockOnHand Decimal  @default(0) @db.Decimal(14, 4)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user   User?   @relation(fields: [userId], references: [id])
  userId String?
}

model Client {
  id       String       @id @default(cuid())
  type     SupplierType @default(PF)
  name     String
  document String       @unique
  email    String?      @unique
  phone    String?
  status   Int          @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  address Address?
}

model Address {
  id           String  @id @default(cuid())
  street       String
  number       String
  complement   String?
  neighborhood String
  city         String
  state        String
  zipCode      String

  clientId String? @unique
  client   Client? @relation(fields: [clientId], references: [id])
}

// model Movement {
//   id           String            @id @default(cuid())
//   type         StockMovementType
//   movementDate DateTime          @default(now())

//   userId String
//   user   User   @relation("StockMovementUser", fields: [userId], references: [id])

//   supplierId String?
//   supplier   Supplier? @relation(fields: [supplierId], references: [id])

//   // lado inverso da relação 1:1 com Order
//   // (quem tem a FK é o Order)
//   order Order? @relation("OrderStockMovement")

//   notes String?        @db.Text
//   items MovementItem[]

//   @@index([type, movementDate])
// }

// model MovementItem {
//   id String @id @default(cuid())

//   movementId String
//   movement   Movement @relation(fields: [movementId], references: [id])

//   productId String
//   product   Product @relation(fields: [productId], references: [id])

//   quantity  Decimal  @db.Decimal(10, 4)
//   costPrice Decimal? @db.Decimal(10, 2)
//   salePrice Decimal? @db.Decimal(10, 2)

//   @@unique([movementId, productId])
//   @@index([productId])
// }

// model Order {
//   id String @id @default(cuid())

//   clientId String
//   client   Client @relation(fields: [clientId], references: [id])

//   userId String
//   user   User   @relation("SalesUserOrders", fields: [userId], references: [id])

//   // data que vem do front
//   orderDate DateTime @default(now())

//   status OrderStatus @default(DRAFT)
//   notes  String?     @db.Text

//   // valores opcionais
//   freight  Decimal? @db.Decimal(14, 2)
//   discount Decimal? @db.Decimal(14, 2)

//   // relação 1:1 com movimento de saída
//   movementId    String?   @unique
//   stockMovement Movement? @relation("OrderStockMovement", fields: [movementId], references: [id])

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   items OrderItem[]

//   @@index([clientId])
//   @@index([userId])
//   @@index([status])
// }

// model OrderItem {
//   id      Int    @id @default(autoincrement())
//   orderId String
//   order   Order  @relation(fields: [orderId], references: [id])

//   productId String
//   product   Product @relation(fields: [productId], references: [id])

//   quantity   Decimal @db.Decimal(10, 4)
//   unitPrice  Decimal @db.Decimal(14, 2)
//   totalPrice Decimal @db.Decimal(14, 2)

//   unitCostAtSale Decimal? @db.Decimal(14, 6)

//   @@unique([orderId, productId])
// }
